// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Cx from "rescript-classnames/src/Cx.res.mjs";
import * as Hooks from "../../hooks/Hooks.res.mjs";
import * as Icons from "../../ui/Icons.res.mjs";
import * as Utils from "../../Utils.res.mjs";
import * as React from "react";
import * as Player from "../../Player.res.mjs";
import * as Slider from "../../ui/Slider.res.mjs";
import * as Spinner from "../../ui/Spinner.res.mjs";
import * as Shortcut from "./Shortcut.res.mjs";
import * as Subtitles from "./Subtitles.res.mjs";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as Core__Option from "@rescript/core/src/Core__Option.res.mjs";
import * as Core__Promise from "@rescript/core/src/Core__Promise.res.mjs";
import * as EditorContext from "./EditorContext.res.mjs";
import * as VolumePopover from "../../ui/VolumePopover.res.mjs";
import * as JsxRuntime from "react/jsx-runtime";
import DockButton from "../../ui/DockButton";
import * as Webapi__Dom__Window from "rescript-webapi/src/Webapi/Dom/Webapi__Dom__Window.res.mjs";
import * as SubtitleExportDropdown from "../../ui/SubtitleExportDropdown.res.mjs";
import * as Webapi__Dom__EventTarget from "rescript-webapi/src/Webapi/Dom/Webapi__Dom__EventTarget.res.mjs";
import * as Solid from "@heroicons/react/24/solid";
import * as VideoExportFormatDropdown from "../../ui/VideoExportFormatDropdown.res.mjs";
import * as Outline from "@heroicons/react/24/outline";
import * as Webapi__Dom__HtmlTextAreaElement from "rescript-webapi/src/Webapi/Dom/Webapi__Dom__HtmlTextAreaElement.res.mjs";

var make = DockButton;

var DockButton$1 = {
  make: make
};

var DocumentEvent = Webapi__Dom__EventTarget.Impl({});

function resolve(prim) {
  return Promise.resolve(prim);
}

var $$Promise$1 = {
  $$catch: Core__Promise.$$catch,
  resolve: resolve
};

var shortcuts = [
  {
    action: "PlayOrPause",
    key: " ",
    modifier: "NoModifier"
  },
  {
    action: "SeekForward",
    key: "ArrowRight",
    modifier: "NoModifier"
  },
  {
    action: "SeekForward",
    key: "l",
    modifier: "NoModifier"
  },
  {
    action: "SeekBack",
    key: "ArrowLeft",
    modifier: "NoModifier"
  },
  {
    action: "SeekBack",
    key: "h",
    modifier: "NoModifier"
  },
  {
    action: "SeekToPreviousCue",
    key: "ArrowUp",
    modifier: "NoModifier"
  },
  {
    action: "SeekToPreviousCue",
    key: "k",
    modifier: "NoModifier"
  },
  {
    action: "SeekToNextCue",
    key: "ArrowDown",
    modifier: "NoModifier"
  },
  {
    action: "SeekToNextCue",
    key: "j",
    modifier: "NoModifier"
  },
  {
    action: "EditCurrentSubtitle",
    key: "i",
    modifier: "NoModifier"
  },
  {
    action: "EditCurrentSubtitle",
    key: "Enter",
    modifier: "NoModifier"
  },
  {
    action: "StartRender",
    key: "r",
    modifier: "NoModifier"
  },
  {
    action: "ToggleFullScreen",
    key: "f",
    modifier: "NoModifier"
  },
  {
    action: "Mute",
    key: "m",
    modifier: "NoModifier"
  },
  {
    action: "SeekToStart",
    key: "Home",
    modifier: "NoModifier"
  },
  {
    action: "SeekToStart",
    key: "ArrowLeft",
    modifier: "Meta"
  },
  {
    action: "SeekToEnd",
    key: "End",
    modifier: "NoModifier"
  },
  {
    action: "SeekToEnd",
    key: "ArrowRight",
    modifier: "Meta"
  },
  {
    action: "IncreaseVolume",
    key: "ArrowUp",
    modifier: "Meta"
  },
  {
    action: "DecreaseVolume",
    key: "ArrowDown",
    modifier: "Meta"
  }
];

var make$1 = Utils.neverRerender(function (props) {
      return JsxRuntime.jsx("div", {
                  children: JsxRuntime.jsx("hr", {
                        className: "mx-2 h-9 border-gray-600 border bg-none"
                      }),
                  className: "hidden md:block"
                });
    });

var DockDivider = {
  make: make$1
};

var baseClass = "flex items-center justify-center p-1.5 md:p-2 shadow rounded-lg md:rounded-xl bg-zinc-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-orange-500 duration-300 md:relative md:bottom-3";

var make$2 = React.memo(function (props) {
      var __className = props.className;
      var className = __className !== undefined ? __className : "";
      return JsxRuntime.jsx("div", {
                  children: props.children,
                  className: Cx.cx([
                        baseClass,
                        className
                      ])
                });
    });

var DockSpace = {
  baseClass: baseClass,
  make: make$2
};

function volumeIcon(volume) {
  if (volume !== undefined && volume > 0) {
    return JsxRuntime.jsx(Outline.SpeakerWaveIcon, {
                className: "size-5 md:size-7"
              });
  } else {
    return JsxRuntime.jsx(Outline.SpeakerXMarkIcon, {
                className: "size-5 md:size-7 text-gray-400"
              });
  }
}

function Dock(props) {
  var fullScreenToggler = props.fullScreenToggler;
  var render = props.render;
  var subtitlesManager = props.subtitlesManager;
  var context = EditorContext.useEditorContext();
  var match = Hooks.useToggle(false);
  var collapsedToggle = match[1];
  var match$1 = context.usePlayer();
  var playerDispatch = match$1[1];
  var player = match$1[0];
  var match$2 = React.useState(function () {
        return VideoExportFormatDropdown.makeDefaultSettings();
      });
  var setExportSettings = match$2[1];
  var exportSettings = match$2[0];
  var handlePlayOrPause = function (param) {
    var match = context.getImmediatePlayerState().playState;
    var tmp;
    tmp = match === "Playing" ? "Pause" : "Play";
    playerDispatch(tmp);
  };
  var handleSetVolume = Hooks.useEvent(function (value) {
        playerDispatch({
              TAG: "SetVolume",
              _0: value
            });
      });
  var increaseVolume = Hooks.useEvent(function () {
        Core__Option.forEach(context.getImmediatePlayerState().volume, (function (volume) {
                playerDispatch({
                      TAG: "SetVolume",
                      _0: Player.validateVolume(volume + 5 | 0)
                    });
              }));
      });
  var decreaseVolume = Hooks.useEvent(function () {
        Core__Option.forEach(context.getImmediatePlayerState().volume, (function (volume) {
                playerDispatch({
                      TAG: "SetVolume",
                      _0: Player.validateVolume(volume - 5 | 0)
                    });
              }));
      });
  var handleSeekLeft = Hooks.useEvent(function () {
        playerDispatch({
              TAG: "Seek",
              _0: context.getImmediatePlayerState().ts - 2
            });
      });
  var handleSeekRight = Hooks.useEvent(function () {
        playerDispatch({
              TAG: "Seek",
              _0: context.getImmediatePlayerState().ts + 2
            });
      });
  var toggleMute = Hooks.useEvent(function () {
        playerDispatch({
              TAG: "SetVolume",
              _0: 0
            });
      });
  var seekToStart = Hooks.useEvent(function () {
        playerDispatch({
              TAG: "Seek",
              _0: 0
            });
      });
  var seekToEnd = Hooks.useEvent(function () {
        playerDispatch({
              TAG: "Seek",
              _0: context.videoMeta.duration
            });
      });
  var editCurrentSubtitle = Hooks.useEvent(function () {
        Core__Option.forEach(Core__Option.flatMap(Caml_option.nullable_to_opt(document.getElementById("current-cue-textarea")), Webapi__Dom__HtmlTextAreaElement.ofElement), (function (textarea) {
                textarea.focus();
                var len = textarea.value.length;
                textarea.selectionStart = len;
                textarea.selectionEnd = len;
              }));
      });
  var moveToCue = Hooks.useEvent(function (shift) {
        var currentOrLastCue = Utils.$$Option.unwrapOrElse(context.getImmediatePlayerState().currentPlayingCue, (function () {
                return Subtitles.lookUpLastPlayedCue(subtitlesManager.activeSubtitles, context.getImmediatePlayerState().ts);
              }));
        if (currentOrLastCue === undefined) {
          if (shift < 0) {
            return handleSeekLeft();
          } else if (shift > 0) {
            return handleSeekRight();
          } else {
            return ;
          }
        }
        var newCue = subtitlesManager.activeSubtitles[currentOrLastCue.currentIndex + shift | 0];
        if (newCue !== undefined) {
          return playerDispatch({
                      TAG: "Seek",
                      _0: Subtitles.start(newCue)
                    });
        }
        
      });
  var startRender = Hooks.useEvent(function () {
        playerDispatch("StopForRender");
        Core__Promise.$$catch(render(context.getImmediateStyleState(), VideoExportFormatDropdown.formatToString(exportSettings.format), VideoExportFormatDropdown.videoCodecToString(exportSettings.videoCodec), VideoExportFormatDropdown.audioCodecToString(exportSettings.audioCodec)), (function (param) {
                return Promise.resolve(playerDispatch("AbortRender"));
              }));
      });
  Shortcut.useKeyboardShortcuts(shortcuts, (function (shortcut) {
          var match = shortcut.action;
          switch (match) {
            case "PlayOrPause" :
                return handlePlayOrPause();
            case "SeekForward" :
                return handleSeekRight();
            case "SeekBack" :
                return handleSeekLeft();
            case "IncreaseVolume" :
                return increaseVolume();
            case "DecreaseVolume" :
                return decreaseVolume();
            case "EditCurrentSubtitle" :
                return editCurrentSubtitle();
            case "ToggleDock" :
                return collapsedToggle.toggle();
            case "StartRender" :
                return startRender();
            case "ToggleFullScreen" :
                return fullScreenToggler.toggle();
            case "SeekToStart" :
                return seekToStart();
            case "SeekToEnd" :
                return seekToEnd();
            case "Mute" :
                return toggleMute();
            case "SeekToNextCue" :
                return moveToCue(1);
            case "SeekToPreviousCue" :
                return moveToCue(-1);
            
          }
        }));
  var match$3 = player.playState;
  var tmp;
  switch (match$3) {
    case "Playing" :
        tmp = JsxRuntime.jsx(Solid.PauseIcon, {
              className: "size-6"
            });
        break;
    case "Paused" :
    case "Idle" :
        tmp = JsxRuntime.jsx(Solid.PlayIcon, {
              className: "size-6"
            });
        break;
    case "StoppedForRender" :
        tmp = JsxRuntime.jsx(Spinner.make, {
              size: 1.25,
              className: ""
            });
        break;
    
  }
  var match$4 = subtitlesManager.transcriptionState;
  var tmp$1;
  if (typeof match$4 !== "object") {
    tmp$1 = null;
  } else {
    var subtitles = subtitlesManager.activeSubtitles;
    tmp$1 = JsxRuntime.jsxs(JsxRuntime.Fragment, {
          children: [
            JsxRuntime.jsx(make$1, {}),
            JsxRuntime.jsx(SubtitleExportDropdown.make, {
                  subtitles: subtitles,
                  sideOffset: 5,
                  align: "start",
                  videoFileName: props.videoFileName,
                  children: JsxRuntime.jsxs(make, {
                        children: [
                          JsxRuntime.jsx(Outline.ArrowDownTrayIcon, {
                                className: "size-5 md:mr-2 md:size-4"
                              }),
                          JsxRuntime.jsx("span", {
                                children: "Export",
                                className: "hidden md:inline"
                              })
                        ],
                        label: "Export subtitles",
                        className: "hover:!scale-100"
                      })
                }),
            JsxRuntime.jsx(VideoExportFormatDropdown.make, {
                  settings: exportSettings,
                  onSettingsChange: (function (settings) {
                      setExportSettings(function (param) {
                            return settings;
                          });
                    }),
                  onRender: startRender,
                  sideOffset: 5,
                  align: "end",
                  children: JsxRuntime.jsxs(make, {
                        children: [
                          JsxRuntime.jsx(Outline.RocketLaunchIcon, {
                                className: "size-5"
                              }),
                          JsxRuntime.jsx("span", {
                                children: "Render",
                                className: "hidden md:inline ml-1"
                              })
                        ],
                        label: "Render video",
                        className: "whitespace-nowrap font-medium hover:!scale-100 md:hover:!scale-105 md:hover:!bg-orange-400 px-2 md:px-4",
                        highlight: true
                      })
                })
          ]
        });
  }
  return JsxRuntime.jsxs("div", {
              children: [
                JsxRuntime.jsxs(make$2, {
                      children: [
                        JsxRuntime.jsx("span", {
                              children: Utils.Duration.formatSeconds(player.ts)
                            }),
                        JsxRuntime.jsx("span", {
                              children: "/",
                              className: "normal-nums"
                            }),
                        JsxRuntime.jsx("span", {
                              children: Utils.Duration.formatSeconds(context.videoMeta.duration)
                            })
                      ],
                      className: "tabular-nums text-xs md:text-sm gap-0.5 md:space-x-1 whitespace-nowrap shrink-0"
                    }),
                JsxRuntime.jsx(make$1, {}),
                JsxRuntime.jsx(make, {
                      children: JsxRuntime.jsx(Icons.BackwardIcon.make, {
                            className: "size-5"
                          }),
                      label: "Seek backward",
                      onClick: handleSeekLeft
                    }),
                JsxRuntime.jsx(make, {
                      children: tmp,
                      label: "Play/Pause",
                      onClick: handlePlayOrPause,
                      highlight: true
                    }),
                JsxRuntime.jsx(make, {
                      children: JsxRuntime.jsx(Outline.ArrowUturnRightIcon, {
                            className: "size-5"
                          }),
                      label: "Seek forward",
                      onClick: handleSeekRight
                    }),
                JsxRuntime.jsx("div", {
                      children: JsxRuntime.jsx(VolumePopover.make, {
                            volume: player.volume,
                            onVolumeChange: handleSetVolume,
                            minVolume: Player.min_volume,
                            maxVolume: Player.max_volume,
                            children: JsxRuntime.jsx(make, {
                                  children: volumeIcon(player.volume),
                                  label: "Volume"
                                })
                          }),
                      className: "md:hidden"
                    }),
                JsxRuntime.jsxs(make$2, {
                      children: [
                        volumeIcon(player.volume),
                        JsxRuntime.jsx(Slider.make, {
                              onValueChange: handleSetVolume,
                              disabled: Core__Option.isNone(player.volume),
                              value: Utils.$$Option.unwrapOr(player.volume, 0),
                              min: Player.min_volume,
                              max: Player.max_volume,
                              step: 1
                            })
                      ],
                      className: "hidden md:flex w-40 shrink-0"
                    }),
                JsxRuntime.jsx(make$1, {}),
                JsxRuntime.jsx("div", {
                      children: JsxRuntime.jsx(make, {
                            children: JsxRuntime.jsx(Outline.ArrowsPointingOutIcon, {
                                  className: "size-6"
                                }),
                            label: "Fullscreen",
                            onClick: fullScreenToggler.toggle
                          }),
                      className: "hidden md:block"
                    }),
                JsxRuntime.jsx("div", {
                      children: JsxRuntime.jsx(make, {
                            children: JsxRuntime.jsx(Outline.PencilSquareIcon, {
                                  className: "size-6"
                                }),
                            label: "Edit subtitle",
                            onClick: editCurrentSubtitle
                          }),
                      className: "hidden md:block"
                    }),
                tmp$1
              ],
              className: Cx.cx([
                    "flex flex-row items-center gap-1.5 px-2 py-1 overflow-x-auto max-w-full",
                    "md:absolute md:bottom-0 md:left-1/2 md:-translate-x-1/2 md:px-4 md:pt-1 md:pb-0 md:gap-2 md:bg-zinc-900/30 md:border-t md:border-x md:border-gray-100/20 md:shadow-xl md:rounded-t-lg md:backdrop-blur-lg md:overflow-visible",
                    match[0] ? "md:translate-y-16 md:duration-300" : ""
                  ])
            });
}

var make$3 = Dock;

export {
  DockButton$1 as DockButton,
  DocumentEvent ,
  $$Promise$1 as $$Promise,
  shortcuts ,
  DockDivider ,
  DockSpace ,
  volumeIcon ,
  make$3 as make,
}
/* make Not a pure module */
